# 任务删除功能测试指南

## 🚀 快速开始

### 方法 1: 正常测试 (25分钟)

```bash
# 1. 启动前端
cd frontend
npm run dev

# 2. 打开浏览器
http://localhost:5173/

# 3. 等待 25 分钟完整测试
```

### 方法 2: 快速测试 (1分钟) ⭐ 推荐

临时使用测试模式:

```bash
# 1. 备份原文件
copy frontend\src\pages\FocusPage.tsx frontend\src\pages\FocusPage.BACKUP.tsx

# 2. 使用测试版本
copy frontend\src\pages\FocusPage.TESTMODE.tsx frontend\src\pages\FocusPage.tsx

# 3. 启动前端
cd frontend
npm run dev

# 4. 测试完成后恢复
copy frontend\src\pages\FocusPage.BACKUP.tsx frontend\src\pages\FocusPage.tsx
```

或者直接运行:
```bash
test-task-deletion.bat
```

## 📝 测试步骤

### 测试 1: 手动删除任务 (最简单)

1. 打开 http://localhost:5173/
2. 创建 3 个任务:
   - "完成报告"
   - "学习 React"
   - "写代码"
3. **鼠标悬停**在任务上
4. 观察右侧出现 🗑️ 图标
5. 点击删除图标
6. ✅ **预期**: 任务立即消失

**测试要点**:
- [ ] 图标默认不可见
- [ ] 悬停时平滑渐显
- [ ] 图标悬停时变红色
- [ ] 点击后任务立即删除
- [ ] 其他任务不受影响

---

### 测试 2: 删除选中的任务

1. 创建任务 "测试选中删除"
2. **点击选中**该任务 (会有高亮边框)
3. 观察上方显示 "Working on: 测试选中删除"
4. **悬停并点击删除**
5. ✅ **预期**:
   - 任务删除
   - "Working on" 区域消失
   - 选中状态清除

**测试要点**:
- [ ] 选中状态正确清除
- [ ] UI 更新同步
- [ ] 没有错误提示

---

### 测试 3: 自动删除完成的任务 (核心功能)

#### 如果使用快速测试模式 (1分钟):

1. 创建任务 "自动删除测试"
2. **选中**该任务
3. 点击 **Start** 按钮
4. 等待 **1 分钟**
5. ✅ **预期**:
   - 听到完成提示音
   - 任务自动从列表消失
   - 显示 "Completed today: 1 sessions"
   - 切换到 Break Time

#### 如果使用正常模式 (25分钟):

1. 创建任务 "完整流程测试"
2. 选中该任务
3. 点击 Start
4. 等待 25 分钟 (可以做其他事情)
5. 回来检查结果

**测试要点**:
- [ ] 计时完成后自动删除
- [ ] 完成计数增加
- [ ] 切换到 Break Time
- [ ] 没有错误提示

---

### 测试 4: 多任务场景

1. 创建 5 个任务
2. 选中第 3 个任务
3. 启动计时
4. 完成后观察
5. ✅ **预期**:
   - 只有第 3 个任务删除
   - 其他 4 个任务保留

**测试要点**:
- [ ] 只删除当前任务
- [ ] 任务列表顺序不变
- [ ] 可以继续选择其他任务

---

### 测�� 5: 防止误删

1. 创建任务
2. 选中任务
3. **启动计时器** (isRunning = true)
4. 观察任务列表
5. ✅ **预期**:
   - 任务列表隐藏 (计时期间不显示)
   - 无法触发删除操作
   - 计时完成后才能操作

**测试要点**:
- [ ] 运行中任务受保护
- [ ] UI 正确隐藏
- [ ] 逻辑安全

---

## 🎯 测试检查清单

### 手动删除功能
- [ ] ✅ 悬停显示删除按钮
- [ ] ✅ 按钮平滑动画
- [ ] ✅ 悬停时变红色
- [ ] ✅ 点击立即删除
- [ ] ✅ 删除选中任务时清除状态
- [ ] ✅ 不影响其他任务

### 自动删除功能
- [ ] ✅ 完成 Focus Session 后自动删除
- [ ] ✅ 只删除当前任务
- [ ] ✅ 完成计数正确增加
- [ ] ✅ 正确切换到 Break Time
- [ ] ✅ 状态同步更新

### UI/UX
- [ ] ✅ 动画流畅
- [ ] ✅ 视觉反馈清晰
- [ ] ✅ 无闪烁或卡顿
- [ ] ✅ 响应迅速

### 边缘情况
- [ ] ✅ 删除最后一个任务
- [ ] ✅ 删除所有任务
- [ ] ✅ 快速连续删除
- [ ] ✅ 计时期间任务受保护

---

## 🐛 常见问题

### 问题 1: 删除按钮不显示

**原因**: CSS 问题或缓存

**解决**:
```bash
# 清除缓存并重启
npm run dev -- --force
```

### 问题 2: 点击删除时选中了任务

**原因**: 事件冒泡

**检查**: 代码中是否有 `event.stopPropagation()`

### 问题 3: 自动删除不工作

**检查**:
1. 是否选中了任务?
2. 是否完成了整个 Focus Session?
3. 查看浏览器控制台是否有错误

### 问题 4: 删除后页面崩溃

**检查**:
1. 是否正确清除了 selectedTask 状态?
2. 查看控制台错误信息

---

## 📸 视觉效果测试

### 正常状态
```
任务列表:
┌────────────────────────────┐
│ 完成报告                    │
│ 学习 React                  │
│ 写代码                      │
└────────────────────────────┘
```

### 悬停状态 (应该看到图标)
```
┌────────────────────────────┐
│ 完成报告                    │
│ 学习 React              🗑️ │ ← 鼠标在这里
│ 写代码                      │
└────────────────────────────┘
```

### 选中 + 悬停
```
┌────────────────────────────┐
│ 完成报告                    │
│ ┏━━━━━━━━━━━━━━━━━━━━━━┓ │
│ ┃ 学习 React          🗑️┃ │ ← 高亮 + 图标
│ ┗━━━━━━━━━━━━━━━━━━━━━━┛ │
│ 写代码                      │
└────────────────────────────┘
```

---

## 🎬 推荐测试流程

### 5 分钟快速测试 (使用测试模式)

```bash
1. [0:00] 启动测试模式
   - 运行 test-task-deletion.bat

2. [0:30] 测试手动删除
   - 创建 3 个任务
   - 悬停并删除 1 个

3. [1:00] 测试自动删除
   - 创建任务 "测试"
   - 选中并启动

4. [2:00] 等待完成 (1分钟)

5. [2:30] 验证结果
   - 任务已删除 ✅
   - 计数增加 ✅

6. [3:00] 测试边缘情况
   - 删除选中的任务
   - 删除所有任务

7. [4:00] 检查控制台
   - 无错误 ✅

8. [5:00] 完成!
```

### 完整测试 (30 分钟)

使用正常 25 分钟模式,测试真实场景。

---

## ✅ 测试通过标准

所有以下条件都满足:

- ✅ 手动删除按钮显示正常
- ✅ 点击删除立即生效
- ✅ 完成 Focus Session 后自动删除
- ✅ 选中状态正确清除
- ✅ 浏览器控制台无错误
- ✅ 动画流畅自然
- ✅ 无 UI 闪烁或错误

---

## 🔧 测试后清理

如果使用了测试模式:

```bash
# 恢复原始文件
copy frontend\src\pages\FocusPage.BACKUP.tsx frontend\src\pages\FocusPage.tsx

# 删除备份文件
del frontend\src\pages\FocusPage.BACKUP.tsx
del frontend\src\pages\FocusPage.TESTMODE.tsx
```

或者手动修改 `FocusPage.tsx` 第 28 行:
```typescript
// 从:
const duration = sessionType === 'focus' ? 1 : 1

// 改回:
const duration = sessionType === 'focus' ? 25 : 5
```

---

## 📝 测试报告模板

```
测试日期: ___________
测试人员: ___________

手动删除功能:
[ ] 悬停显示  [ ] 点击删除  [ ] 状态清除
结果: ___________

自动删除功能:
[ ] 完成后删除  [ ] 计数增加  [ ] 状态切换
结果: ___________

问题记录:
_______________________________
_______________________________

总体评价: [ ] 通过  [ ] 失败
```

---

现在开始测试吧! 🚀

如果遇到任何问题,记录下来并告诉我。
